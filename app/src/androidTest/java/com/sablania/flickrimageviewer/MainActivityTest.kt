package com.sablania.flickrimageviewer

import androidx.test.core.app.ActivityScenario
import androidx.test.espresso.Espresso.onView
import androidx.test.espresso.action.ViewActions
import androidx.test.espresso.action.ViewActions.typeText
import androidx.test.espresso.assertion.ViewAssertions.matches
import androidx.test.espresso.matcher.ViewMatchers
import androidx.test.espresso.matcher.ViewMatchers.withId
import androidx.test.ext.junit.runners.AndroidJUnit4
import com.sablania.flickrimageviewer.testUtils.BaseRule
import okhttp3.mockwebserver.MockResponse
import org.hamcrest.Matchers.not
import org.junit.Before
import org.junit.ClassRule
import org.junit.Test
import org.junit.runner.RunWith

/**
 * @author Vipul Kumar on 21/07/20.
 */
@RunWith(AndroidJUnit4::class)
class MainActivityTest {

    companion object {
        @ClassRule
        @JvmField
        val rule = BaseRule()
    }

    @Before
    fun setUp() {
    }

    @Test
    fun testBasicUiVisibility_NonNullData_RecyclerView() {
        val mockApiRespPage1 =
            "{\"photos\":{\"page\":1,\"pages\":8257,\"perpage\":25,\"total\":\"206418\",\"photo\":[{\"id\":\"50138089537\",\"owner\":\"57007167@N03\",\"secret\":\"928875fe8e\",\"server\":\"65535\",\"farm\":66,\"title\":\"POP-UP MAINSTORE WEEK By TRES CHIC\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137140093\",\"owner\":\"12349220@N00\",\"secret\":\"20d00d3b5d\",\"server\":\"65535\",\"farm\":66,\"title\":\"Say Hello To The Green Lizard Boys, Again\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137681436\",\"owner\":\"189413933@N06\",\"secret\":\"0d992632c6\",\"server\":\"65535\",\"farm\":66,\"title\":\"Five Chase Virtual Credit Card That Had Gone Way Too Far | chase virtual credit card\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137850797\",\"owner\":\"186907147@N07\",\"secret\":\"c8360563e5\",\"server\":\"65535\",\"farm\":66,\"title\":\"Toxic Grenade\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"46972709394\",\"owner\":\"39838684@N00\",\"secret\":\"40f6791190\",\"server\":\"65535\",\"farm\":66,\"title\":\"2018-19 SUMMARY\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136930843\",\"owner\":\"165639598@N08\",\"secret\":\"0732bd753a\",\"server\":\"65535\",\"farm\":66,\"title\":\"2058 - Castellnou  (Pa\\u00eds Valenci\\u00e0)\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137439471\",\"owner\":\"144290189@N04\",\"secret\":\"f46c1bcb33\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137323881\",\"owner\":\"60688846@N08\",\"secret\":\"507f0784fa\",\"server\":\"65535\",\"farm\":66,\"title\":\"nowadays\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137323826\",\"owner\":\"60688846@N08\",\"secret\":\"42709e1166\",\"server\":\"65535\",\"farm\":66,\"title\":\"the weight of a sack of rice\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137323736\",\"owner\":\"60688846@N08\",\"secret\":\"befc4b7f31\",\"server\":\"65535\",\"farm\":66,\"title\":\"07212020_Eastwood_DSI02152\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136781513\",\"owner\":\"60688846@N08\",\"secret\":\"bdb8ed5b27\",\"server\":\"65535\",\"farm\":66,\"title\":\"07212020_Eastwood_DSI02141\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137323556\",\"owner\":\"60688846@N08\",\"secret\":\"0358fcf6e2\",\"server\":\"65535\",\"farm\":66,\"title\":\"Hands on driver\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137323421\",\"owner\":\"60688846@N08\",\"secret\":\"14381989e7\",\"server\":\"65535\",\"farm\":66,\"title\":\"Palmer\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137559927\",\"owner\":\"60688846@N08\",\"secret\":\"2f114b1a17\",\"server\":\"65535\",\"farm\":66,\"title\":\"07212020_Eastwood_DSI02117\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137183826\",\"owner\":\"59141570@N02\",\"secret\":\"1f55a88560\",\"server\":\"65535\",\"farm\":66,\"title\":\"LOOK #013\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137198976\",\"owner\":\"187162217@N05\",\"secret\":\"d01661e8dd\",\"server\":\"65535\",\"farm\":66,\"title\":\"free chat messenger\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137108666\",\"owner\":\"189395951@N07\",\"secret\":\"7ece9e424a\",\"server\":\"65535\",\"farm\":66,\"title\":\"9 Mind-Blowing Reasons Why Amazon Credit Card Is Using This Technique For Exposure | amazon credit card\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50137213712\",\"owner\":\"9341577@N08\",\"secret\":\"354179ab03\",\"server\":\"65535\",\"farm\":66,\"title\":\"Manhattan, New York\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136954341\",\"owner\":\"189413933@N06\",\"secret\":\"eba9619662\",\"server\":\"65535\",\"farm\":66,\"title\":\"This Story Behind Fake Name Generator Credit Card Will Haunt You Forever! | fake name generator credit card\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136838986\",\"owner\":\"185902505@N06\",\"secret\":\"a6d2df61c7\",\"server\":\"65535\",\"farm\":66,\"title\":\"How to Fix the Image Upload Issue in WordPress\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136804536\",\"owner\":\"141482711@N03\",\"secret\":\"5b17cc35c1\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random Faces #4\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136963007\",\"owner\":\"33182025@N00\",\"secret\":\"2d2447c467\",\"server\":\"65535\",\"farm\":66,\"title\":\"The FE\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136183028\",\"owner\":\"33182025@N00\",\"secret\":\"e14927a342\",\"server\":\"65535\",\"farm\":66,\"title\":\"Condo Tower\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136962832\",\"owner\":\"33182025@N00\",\"secret\":\"3937422a71\",\"server\":\"65535\",\"farm\":66,\"title\":\"The Village\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136725591\",\"owner\":\"33182025@N00\",\"secret\":\"b05eb4dddb\",\"server\":\"65535\",\"farm\":66,\"title\":\"School Log\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0}]},\"stat\":\"ok\"}"
        val mockApiRespPage2 =
            "{\"photos\":{\"page\":2,\"pages\":8257,\"perpage\":25,\"total\":\"206418\",\"photo\":[{\"id\":\"50136182808\",\"owner\":\"33182025@N00\",\"secret\":\"c8c2f96f6d\",\"server\":\"65535\",\"farm\":66,\"title\":\"Clean Up!\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136962627\",\"owner\":\"33182025@N00\",\"secret\":\"52ff47ca13\",\"server\":\"65535\",\"farm\":66,\"title\":\"Into the Woods\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136182663\",\"owner\":\"33182025@N00\",\"secret\":\"5df9bed6f9\",\"server\":\"65535\",\"farm\":66,\"title\":\"The Best\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136084108\",\"owner\":\"104482302@N04\",\"secret\":\"e0e79b0fcb\",\"server\":\"65535\",\"farm\":66,\"title\":\"Highs and Lows\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"14503198048\",\"owner\":\"116673126@N08\",\"secret\":\"64764b95ca\",\"server\":\"65535\",\"farm\":66,\"title\":\"G-AVPB British Airways Boeing 707-336C seen on final approach to 28L at London Heathrow\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136590646\",\"owner\":\"185902505@N06\",\"secret\":\"6ac6a73a99\",\"server\":\"65535\",\"farm\":66,\"title\":\"iPhone Slow How to Clear RAM on Your iPhone to Make It Faster\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135962823\",\"owner\":\"189357567@N03\",\"secret\":\"52ba07e6a4\",\"server\":\"65535\",\"farm\":66,\"title\":\"New proposals to understand how the planet's vegetation works\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135916268\",\"owner\":\"189326256@N02\",\"secret\":\"aa9e035f84\",\"server\":\"65535\",\"farm\":66,\"title\":\"Organizing with Tupperware\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136617082\",\"owner\":\"27875076@N00\",\"secret\":\"7cc751b492\",\"server\":\"65535\",\"farm\":66,\"title\":\"8mm\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136446582\",\"owner\":\"80075377@N05\",\"secret\":\"89bce02cdd\",\"server\":\"65535\",\"farm\":66,\"title\":\"Hong Kong Government Vehicle\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135616393\",\"owner\":\"34824948@N05\",\"secret\":\"f994551fd3\",\"server\":\"65535\",\"farm\":66,\"title\":\"Rorschach's Owl & the Ogre\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"28597682741\",\"owner\":\"116673126@N08\",\"secret\":\"5559292be5\",\"server\":\"65535\",\"farm\":66,\"title\":\"G-AXXY British Airways Boeing 707-336B seen about to take off on runway 10R at London Heathrow\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135591603\",\"owner\":\"187893066@N08\",\"secret\":\"440535ebd9\",\"server\":\"65535\",\"farm\":66,\"title\":\"snapshot\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135528328\",\"owner\":\"187893066@N08\",\"secret\":\"a7415cfe4f\",\"server\":\"65535\",\"farm\":66,\"title\":\"snapshot\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136066996\",\"owner\":\"187893066@N08\",\"secret\":\"b54602e8f7\",\"server\":\"65535\",\"farm\":66,\"title\":\"snapshot\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135991816\",\"owner\":\"186799479@N06\",\"secret\":\"e37bd306c8\",\"server\":\"65535\",\"farm\":66,\"title\":\"Space Junkie\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135448658\",\"owner\":\"186799479@N06\",\"secret\":\"2d2099825d\",\"server\":\"65535\",\"farm\":66,\"title\":\"Space Junkie\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135984341\",\"owner\":\"144838325@N07\",\"secret\":\"e86a79795a\",\"server\":\"65535\",\"farm\":66,\"title\":\"Focuspointless\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136101082\",\"owner\":\"40646519@N00\",\"secret\":\"d49019979c\",\"server\":\"65535\",\"farm\":66,\"title\":\"King\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135864021\",\"owner\":\"40646519@N00\",\"secret\":\"d0349d4d49\",\"server\":\"65535\",\"farm\":66,\"title\":\"Delsey\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50136100682\",\"owner\":\"40646519@N00\",\"secret\":\"df777ec09a\",\"server\":\"65535\",\"farm\":66,\"title\":\"Vogue\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135863566\",\"owner\":\"40646519@N00\",\"secret\":\"f00504dc49\",\"server\":\"65535\",\"farm\":66,\"title\":\"Hogar\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135840576\",\"owner\":\"133103727@N03\",\"secret\":\"7a383eb674\",\"server\":\"65535\",\"farm\":66,\"title\":\"Family Portrait\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135831847\",\"owner\":\"19540747@N05\",\"secret\":\"11d8a99ee6\",\"server\":\"65535\",\"farm\":66,\"title\":\"Eu050 at the modra ruze-blue roses\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134915733\",\"owner\":\"189386976@N04\",\"secret\":\"385990d232\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random house\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0}]},\"stat\":\"ok\"}"
        val mockApiRespPage3 =
            "{\"photos\":{\"page\":3,\"pages\":8257,\"perpage\":25,\"total\":\"206418\",\"photo\":[{\"id\":\"50135403461\",\"owner\":\"141038001@N02\",\"secret\":\"45bc3f7121\",\"server\":\"65535\",\"farm\":66,\"title\":\"Access Vlog July '20\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134871568\",\"owner\":\"98403995@N08\",\"secret\":\"884c809383\",\"server\":\"65535\",\"farm\":66,\"title\":\"India - Madhya Pradesh - Khajuraho - Khajuraho Group Of Monuments - 315dd\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135401486\",\"owner\":\"7707859@N03\",\"secret\":\"30c2cd5894\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random Creations\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135334421\",\"owner\":\"166252065@N07\",\"secret\":\"6ce4b354b7\",\"server\":\"65535\",\"farm\":66,\"title\":\"- the man who made a monster\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135333741\",\"owner\":\"40761412@N00\",\"secret\":\"b040d4047b\",\"server\":\"65535\",\"farm\":66,\"title\":\"Who Made Who?\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134731878\",\"owner\":\"184413286@N02\",\"secret\":\"f7d94c54dc\",\"server\":\"65535\",\"farm\":66,\"title\":\"Sinner or Saint?\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134731918\",\"owner\":\"184413286@N02\",\"secret\":\"1a121afc7d\",\"server\":\"65535\",\"farm\":66,\"title\":\"Carol Anne????\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135276206\",\"owner\":\"7158589@N06\",\"secret\":\"91e502379a\",\"server\":\"65535\",\"farm\":66,\"title\":\"Everything is FOOD! - Macaroni, Butter, and Cheese!\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134720188\",\"owner\":\"12349220@N00\",\"secret\":\"fbec3a72f3\",\"server\":\"65535\",\"farm\":66,\"title\":\"Sisters Of The Psyche Redux (tamed)\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134697818\",\"owner\":\"157554349@N08\",\"secret\":\"a22711c278\",\"server\":\"65535\",\"farm\":66,\"title\":\"BO Random Lot\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135239836\",\"owner\":\"68635735@N02\",\"secret\":\"5beff1af55\",\"server\":\"65535\",\"farm\":66,\"title\":\"36j Lighthouse - Covehead Harbour Lighthouse (PEI, Canada)\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135239766\",\"owner\":\"68635735@N02\",\"secret\":\"dc696c4a52\",\"server\":\"65535\",\"farm\":66,\"title\":\"36k Lighthouse - Dongbaekseom Island Lighthouse (Busan, South Korea)\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135474562\",\"owner\":\"68635735@N02\",\"secret\":\"bb2b4cb753\",\"server\":\"65535\",\"farm\":66,\"title\":\"36l Lighthouse - Navy Point Lighthouse (Stanley, Falkland Islands)\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134684898\",\"owner\":\"141482711@N03\",\"secret\":\"380f050670\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random Faces #3\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135434642\",\"owner\":\"147586214@N04\",\"secret\":\"573b052ae0\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random pics\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134650868\",\"owner\":\"147586214@N04\",\"secret\":\"929bc0d517\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random pics\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134566723\",\"owner\":\"189218722@N07\",\"secret\":\"2512f60126\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random Photo Op.\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50135093191\",\"owner\":\"80689052@N00\",\"secret\":\"224c5793c3\",\"server\":\"65535\",\"farm\":66,\"title\":\"I heard it through the grapevine.\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134973111\",\"owner\":\"73433722@N08\",\"secret\":\"bdb9460ee2\",\"server\":\"65535\",\"farm\":66,\"title\":\"072020_02\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134996282\",\"owner\":\"188089171@N03\",\"secret\":\"f87e570708\",\"server\":\"65535\",\"farm\":66,\"title\":\"Jessica_Perez_Original Imagery003\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"49919687637\",\"owner\":\"143455489@N03\",\"secret\":\"c707345d9a\",\"server\":\"65535\",\"farm\":66,\"title\":\"Lovely Port Macquarie coastline, New South Wales, Australia\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134176493\",\"owner\":\"187493726@N03\",\"secret\":\"7976a84c35\",\"server\":\"65535\",\"farm\":66,\"title\":\"Random Americana\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134170203\",\"owner\":\"182327604@N02\",\"secret\":\"b3592f599c\",\"server\":\"65535\",\"farm\":66,\"title\":\"Minecraft Game\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50134622321\",\"owner\":\"189377931@N04\",\"secret\":\"6c72c4e5d0\",\"server\":\"65535\",\"farm\":66,\"title\":\"How To Determine If You Need To Hire Bed Bug Exterminators In Boston\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0},{\"id\":\"50133863698\",\"owner\":\"189388764@N02\",\"secret\":\"bb1ac251c8\",\"server\":\"65535\",\"farm\":66,\"title\":\"random beach trip 007\",\"ispublic\":1,\"isfriend\":0,\"isfamily\":0}]},\"stat\":\"ok\"}"
        rule.server.enqueue(MockResponse().setResponseCode(200).setBody(mockApiRespPage1))
        rule.server.enqueue(MockResponse().setResponseCode(200).setBody(mockApiRespPage2))
        rule.server.enqueue(MockResponse().setResponseCode(200).setBody(mockApiRespPage3))
        val activityScenario = ActivityScenario.launch(MainActivity::class.java)

        onView(withId(R.id.tiet_search)).check(matches(ViewMatchers.isDisplayed()))
        onView(withId(R.id.tiet_search)).perform((typeText("Random")))
            .perform(ViewActions.pressImeActionButton())
        onView(withId(R.id.rv_images)).check(matches(ViewMatchers.isDisplayed()))
        onView(withId(R.id.tv_no_data_found)).check(matches(not(ViewMatchers.isDisplayed())))
        onView(withId(R.id.layout_api_error_and_retry)).check(matches(not(ViewMatchers.isDisplayed())))
    }

    @Test
    fun testBasicUiVisibility_EmptyData_NoDataView() {
        val mockApiRespPage =
            "{\"photos\":{\"page\":1,\"pages\":0,\"perpage\":25,\"total\":\"0\",\"photo\":[]},\"stat\":\"ok\"}"
        rule.server.enqueue(MockResponse().setResponseCode(200).setBody(mockApiRespPage))
        val activityScenario = ActivityScenario.launch(MainActivity::class.java)

        onView(withId(R.id.tiet_search)).check(matches(ViewMatchers.isDisplayed()))
        onView(withId(R.id.tv_no_data_found)).check(matches(ViewMatchers.isDisplayed()))
        onView(withId(R.id.layout_api_error_and_retry)).check(matches(not(ViewMatchers.isDisplayed())))
    }
}